问题 3 从盘入到盘出，舞龙队将由顺时针盘入调头切换为逆时针盘出，这需要一定的
调头空间。若调头空间是以螺线中心为圆心、直径为 9 m 的圆形区域（见图 5），请确定最
小螺距，使得龙头前把手能够沿着相应的螺线盘入到调头空间的边界。


将问题转化为：寻找最小螺距 p_min，使得在螺距为 p_min 的等距螺线 r = bθ（b=p/(2π)）上，
龙头前把手从第16圈起顺时针盘入，能在不发生碰撞的前提下到达半径 R=4.5 m 的边界（直径9m）。

核心结论（直觉说明）：一旦龙头进入掉头圆的边界，后续路径与先前路径中心对称/相似，尺寸固定，
且我们只关心“盘入至边界”阶段的可达性与碰撞约束。因此寻找在到达边界前“首次碰撞”是否出现即可。

实现思路与步骤（与 q2 同结构，改为对螺距进行外层搜索）：

1) 螺线与运动学（与 q1 一致）
- 等距螺线：r(θ)=bθ，b=p/(2π)；
- 参数方程：x(θ)=r cosθ，y(θ)=r sinθ；
- 弧长：S(θ)=(b/2)[θ√(1+θ²)+asinh(θ)]；
- 龙头沿弧长恒速 v_head=1 m/s 盘入：S(θ(t))=S(θ0)−v_head·t，θ0=2π·16。
- 反解 θ(t)：牛顿/二分（我们用二分夹持），稳定可靠。

2) “画圆找交点”生成整条链
- 两孔中心距（同一板）：
	• 龙头板：L_head=3.41−0.55=2.86m
	• 龙身/龙尾板：L_body=2.20−0.55=1.65m
- 从龙头前把手出发，迭代找满足 |P(θ_{i+1})−P(θ_i)|=L 的最小 θ_{i+1}>θ_i，得到：
	[龙头前]、[第1..221节龙身前]、[龙尾前]，并再加一步得[龙尾后]。

3) 矩形碰撞检测（面积法）
- 每块板视为方向矩形：
	• 中心线：两把手点连线；两端各外伸 0.275m；
	• 半宽：0.15m（板宽0.30m/2）。
- 顶点计算：
	设把手为 P0,P1，û=(P1−P0)/|P1−P0|，v̂=旋转90°(û)；A=P0−0.275û，B=P1+0.275û；
	顶点依次为：[A+0.15v̂, B+0.15v̂, B−0.15v̂, A−0.15v̂]。
- 点在矩形内（面积法）：
	用四三角面积之和与矩形面积比较：|ΣArea(P,Vi,Vi+1)−Area(rect)|<ε ⇒ 点在矩形内。
- 碰撞判定：对每块板的四个顶点，若落入任一“非相邻”板矩形内部（|j−i|>1），则判为碰撞。

4) 到达边界所需时间（用于终止判据）
- 边界半径 R=4.5；目标 θ_t=R/b；
- 令 S0=S(θ0)，St=S(θ_t) ⇒ t_boundary=(S0−St)/v_head。

5) 单个螺距的可达性检查
- 从 t=0 到 t_boundary，以 Δt=1s 推进：
	• 计算 θ(t)、生成链条、构建矩形并做碰撞判定；
	• 若任一点发生碰撞，标记为“失败”；
	• 若始终无碰撞且抵达 t_boundary，标记为“通过（可达）”。

6) 最小螺距搜索
- 粗搜：自 p=0.55m 起，每次减少 0.01m，重复“可达性检查”，直到出现“失败”；
- 二分：在 [失败螺距, 上一可达螺距] 区间内二分，收敛到 1e−4m 精度；
- 若始终可达，则下限受“由外盘入的几何约束”限制：p > R/16（确保初始半径 r0=b·θ0>R）。

7) 速度（非判定所必需）
- 若需一致性输出，可复用速度投影关系 v_i(T_i·U_i)=v_{i+1}(T_{i+1}·U_i) 得到每节速度大小与方向（盘入方向为 −T）。

8) 输出与复现实用
- 代码：`q3/q3cver.py`
- 输出：控制台打印最小可行螺距 p_min，并可选择导出搜索过程到 `data/result3_pitch_search.xlsx`。

复杂度与注意点：
- 单次碰撞检查 O(n²)（n=223），矩形面积法鲁棒且实现简单；
- Δt=1s 的时间离散在实际边界附近足够，但若需更严谨可对临界前后做细分（二分时间）；
- 由于搜的是“最小可达螺距”，粗搜+二分的组合能快速收敛并给出稳定答案。 